---
title: API Reference Overview
description: Panoramica completa delle API REST disponibili in Zuora Workflow Manager
---

# Panoramica API Reference

Zuora Workflow Manager fornisce un set di API REST per l'integrazione programmabile. Questa sezione documentati tutti gli endpoints disponibili, metodi HTTP, e formati request/response.

## Autenticazione

L'API richiede autenticazione tramite Laravel Sanctum.

### Ottenere Token Auth

Dopo aver effettuato login nel pannello Filament, puoi ottenere il token dal dashboard o tramite API.

<Note>
Il token deve essere inviato nell'header `Authorization: Bearer YOUR_TOKEN` con ogni richiesta.
</Note>

## Base URL

L'URL base dipende dall'ambiente:

```bash
# Development
https://zuora-workflows.lndo.site/api

# Production
https://yourdomain.com/api
```

## Endpoints Disponibili

### 1. User Information

Recupera informazioni sull'utente autenticato.

**Endpoint:** `GET /user`

**Authentication:** Richiesto (`auth:sanctum`)

**Request Headers:**
```http
GET /api/user HTTP/1.1
Host: zuora-workflows.lndo.site
Authorization: Bearer YOUR_TOKEN
Accept: application/json
```

**Response Success (200):**
```json
{
  "id": 1,
  "name": "John Doe",
  "email": "john@example.com",
  "email_verified_at": "2025-12-27T10:00:00.000000Z",
  "created_at": "2025-01-01T10:00:00.000000Z",
  "updated_at": "2025-12-27T10:00:00.000000Z"
}
```

**Response Error (401):**
```json
{
  "message": "Unauthenticated"
}
```

### 2. Ottenere Token Zuora

Recupera un OAuth token da Zuora API. Questo endpoint proxy la richiesta a Zuora.

**Endpoint:** `GET /zuora/token`

**Authentication:** Richiesto (`auth:sanctum`)

**Request Headers:**
```http
GET /api/zuora/token HTTP/1.1
Host: zuora-workflows.lndo.site
Authorization: Bearer YOUR_TOKEN
Accept: application/json
```

**Query Parameters:**
Nessun parametro richiesto. Usa le credenziali del customer configurato.

**Response Success (200):**
```json
{
  "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**Response Error (500):**
```json
{
  "error": "Failed to authenticate with Zuora: Invalid credentials"
}
```

**Casi d'Uso:**
- Ottienere token OAuth Zuora per integrazioni esterne
- Test connessione con Zuora API
- Debug autenticazione Zuora

### 3. Download Workflow

Scarica la definizione JSON di uno specifico workflow da Zuora.

**Endpoint:** `GET /zuora/download/{workflowId}`

**Authentication:** Richiesto (`auth:sanctum`)

**Path Parameters:**
| Parametro | Tipo | Richiesto | Descrizione |
|-----------|-------|-----------|-------------|
| `workflowId` | string/int | SÃ¬ | Zuora workflow ID da scaricare |

**Query Parameters:**
| Parametro | Tipo | Richiesto | Descrizione |
|-----------|-------|-----------|-------------|
| `client_id` | string | SÃ¬ | Zuora Client ID del customer |
| `client_secret` | string | SÃ¬ | Zuora Client Secret del customer |
| `base_url` | string | No | Zuora API base URL (default: https://rest.zuora.com) |

**Request Esempio:**
```http
GET /api/zuora/download/2c92a0f8ce4830e9b73411ea6b2a7?client_id=abc123&client_secret=xyz789&base_url=https://rest.zuora.com HTTP/1.1
Host: zuora-workflows.lndo.site
Authorization: Bearer YOUR_TOKEN
Accept: application/json
```

**Response Success (200):**
```json
{
  "id": "2c92a0f8ce4830e9b73411ea6b2a7",
  "name": "My Workflow",
  "description": "Workflow per sincronizzazione customer",
  "version": "1.0",
  "tasks": [
    {
      "id": "task-1",
      "name": "Send Email",
      "action_type": "Email",
      "object": "Email",
      "parameters": {
        "email": {
          "subject": "Notifica Sync",
          "to": "admin@example.com"
        }
      }
    }
  ]
}
```

**Response Error (404):**
```json
{
  "error": "Workflow not found"
}
```

**Response Error (401):**
```json
{
  "error": "Invalid Zuora credentials"
}
```

**Response Error (500):**
```json
{
  "error": "Failed to download workflow: Connection timeout"
}
```

## Headers Standard

### Request Headers

| Header | Richiesto | Descrizione |
|--------|-----------|-------------|
| `Authorization` | SÃ¬ (la maggior parte endpoints) | Token Bearer: `Bearer YOUR_TOKEN` |
| `Accept` | SÃ¬ | Content type accettato: `application/json` |
| `Content-Type` | SÃ¬ (POST/PUT) | Content type del body: `application/json` |

### Response Headers

| Header | Descrizione |
|--------|-------------|
| `Content-Type` | Content type della risposta |
| `Cache-Control` | Politica caching |
| `X-RateLimit-Limit` | Limite rate limiting (se attivo) |
| `X-RateLimit-Remaining` | Richieste rimanenti (se attivo) |

## Errori Standard

### Format Errori

Tutti gli errori seguono questo formato:

```json
{
  "message": "Descrizione dell'errore",
  "errors": {
    "field": ["Errore specifico del campo"]
  },
  "exception": "NomeException"
}
```

### Codici Status HTTP

| Codice | Significato | Descrizione |
|---------|-------------|-------------|
| `200` | OK | Richiesta completata con successo |
| `201` | Created | Risorsa creata con successo |
| `400` | Bad Request | Richiesta malformata |
| `401` | Unauthorized | Token di autenticazione non valido o mancante |
| `403` | Forbidden | Non hai permessi sufficienti |
| `404` | Not Found | Risorsa non trovata |
| `422` | Unprocessable Entity | Validazione fallita |
| `429` | Too Many Requests | Rate limit superato |
| `500` | Internal Server Error | Errore server interno |
| `503` | Service Unavailable | Servizio temporaneamente non disponibile |

## Esempi di Utilizzo

### Esempio 1: Curl - Get User Info

```bash
# Ottieni info utente
curl -X GET https://zuora-workflows.lndo.site/api/user \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Accept: application/json"
```

### Esempio 2: Curl - Get Zuora Token

```bash
# Ottieni token Zuora
curl -X GET "https://zuora-workflows.lndo.site/api/zuora/token" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Accept: application/json"
```

### Esempio 3: Curl - Download Workflow

```bash
# Scarica workflow
curl -X GET "https://zuora-workflows.lndo.site/api/zuora/download/2c92a0f8ce4830e9b73411ea6b2a7?client_id=YOUR_CLIENT_ID&client_secret=YOUR_CLIENT_SECRET&base_url=https://rest.zuora.com" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Accept: application/json" \
  -o workflow.json
```

### Esempio 4: JavaScript Fetch

```javascript
// Get user info
const response = await fetch('https://zuora-workflows.lndo.site/api/user', {
  headers: {
    'Authorization': `Bearer ${token}`,
    'Accept': 'application/json'
  }
});

const user = await response.json();
console.log(user);
```

### Esempio 5: PHP Guzzle

```php
// Download workflow con Guzzle
use GuzzleHttp\Client;

$client = new Client();
$response = $client->request('GET', 'https://zuora-workflows.lndo.site/api/zuora/download/WORKFLOW_ID', [
    'headers' => [
        'Authorization' => 'Bearer ' . $token,
        'Accept' => 'application/json'
    ],
    'query' => [
        'client_id' => $clientId,
        'client_secret' => $clientSecret,
        'base_url' => 'https://rest.zuora.com'
    ]
]);

$workflowData = json_decode($response->getBody(), true);
```

### Esempio 6: Python Requests

```python
import requests

# Get user info
headers = {
    'Authorization': f'Bearer {token}',
    'Accept': 'application/json'
}

response = requests.get('https://zuora-workflows.lndo.site/api/user', headers=headers)
user = response.json()
print(user)
```

## Rate Limiting

<Note>
Attualmente non implementato, ma l'API Ã¨ progettata per supportare rate limiting in futuro.
</Note>

### Rate Limit Headers (Futuro)

```http
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1735272000
```

### Gestione Rate Limit

```php
// Esempio di gestione rate limit
$response = $client->request('GET', '/api/user');

if ($response->getStatusCode() === 429) {
    $resetAt = $response->getHeader('X-RateLimit-Reset')[0];
    sleep($resetAt - time() + 1);
    // Retry request
}
```

## CORS

Per richieste cross-origin, configura CORS in `config/cors.php`:

```php
// config/cors.php

return [
    'paths' => ['api/*', 'sanctum/csrf-cookie'],
    'allowed_methods' => ['*'],
    'allowed_origins' => ['*'],  // Specifica i tuoi domini
    'allowed_origins_patterns' => [],
    'allowed_headers' => ['*'],
    'exposed_headers' => [],
    'max_age' => 0,
    'supports_credentials' => false,
];
```

## Testing API

### Esempio Test Pest

```php
// tests/Feature/ApiTest.php

use App\Models\User;

test('get user info', function () {
    $user = User::factory()->create();
    $token = $user->createToken('test-token')->plainTextToken;

    $response = $this->getJson('/api/user', [
        'Authorization' => "Bearer {$token}"
    ]);

    $response->assertStatus(200)
        ->assertJson([
            'id' => $user->id,
            'name' => $user->name,
            'email' => $user->email
        ]);
});
```

### Test con Postman

1. Importa collection (fornire in futuro)
2. Configura base URL
3. Aggiungi token nell'header Authorization
4. Esegui requests

## Best Practices API

### 1. Gestione Token

```javascript
// Salva token e riutilizza
localStorage.setItem('api_token', token);

// Usa token nelle richieste
const headers = {
    'Authorization': `Bearer ${localStorage.getItem('api_token')}`
};
```

### 2. Gestione Errori

```javascript
try {
    const response = await fetch('/api/user', { headers });
    if (!response.ok) {
        const error = await response.json();
        console.error('API Error:', error.message);
        // Gestisci errore
    }
} catch (error) {
    console.error('Network Error:', error);
}
```

### 3. Pagination

<Note>
Attualmente gli endpoints API non supportano pagination. Implementare se necessario per liste large.
</Note>

```javascript
// Esempio pagination futuro
let page = 1;
let allData = [];

do {
    const response = await fetch(`/api/workflows?page=${page}`);
    const data = await response.json();
    allData.push(...data.data);
    page++;
} while (data.hasMore);
```

## Prossimi Passi

<CardGroup cols={2}>
  <Card title="Authentication" icon="lock" href="/api-reference/authentication">
    Dettagli autenticazione e autorizzazione
  </Card>
  <Card title="Endpoints" icon="endpoint" href="/api-reference/endpoints">
    Documentazione completa endpoints
  </Card>
  <Card title="Examples" icon="code" href="/api-reference/examples">
    Esempi di utilizzo avanzati
  </Card>
  <Card title="Features" icon="play" href="/features/workflows">
    Usa funzionalitÃ  applicazione
  </Card>
</CardGroup>

## Risorse

- ðŸ“– [Laravel API Resources](https://laravel.com/docs/api-resources)
- ðŸ“– [Laravel Sanctum](https://laravel.com/docs/sanctum)
- ðŸ“– [REST API Best Practices](https://restfulapi.net/)
- ðŸ“– [OpenAPI Specification](https://swagger.io/specification/)

---

**Versione API**: 1.0 |
**Ultimo Aggiornamento**: Dicembre 2025
